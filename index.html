<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Jaga-Me | Customer Portal</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
</head>

<body>
<p>Loading...</p>

<!-- REQUIRED JS SCRIPTS -->

<!-- jQuery 2.2.3 -->
<script src="plugins/jQuery/jquery-3.1.1.min.js"></script>
<!-- Auth0 -->
<script src="plugins/auth0/lock-10.9.1.min.js"></script>

<script>
    var clientId = "JixjGGQuDCCwBW8x37dub83gtNxjRN85";
    var domain = "jaga-me-coding-test.auth0.com";

    var lock = new Auth0Lock(clientId, domain, {
        auth: {
            params: {
                scope: 'email'
            }
        }
    });

    $(document).ready(function () {
        if(isLogin()) {
            window.location.href = "portal.html";
        } else {
            lock.show();
        }

        lock.on("authenticated", function(authResult) {
            lock.getUserInfo(authResult.accessToken, function(error, profile) {
                if (error) {
                    console.log(error.toString());
                    return;
                }

                localStorage.setItem('access_token', authResult.accessToken);
                localStorage.setItem('profile', JSON.stringify(profile));

                window.location.href = "portal.html";
            });
        });
    });

    /* Returns true if the user is login */
    function isLogin() {
        var access_token = localStorage.getItem('access_token');

        if (null == access_token) {
            return false;
        } else {
            return true;
        }
    }
</script>
</body>
</html>
